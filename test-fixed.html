<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Corrigido - Teste</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
        }
        .controls {
            margin-bottom: 20px;
            text-align: center;
        }
        .btn {
            margin: 5px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-special { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        #world {
            border: 2px solid #333;
            background: #2a2a2a;
            margin: 0 auto;
            display: block;
        }
        .info {
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button id="addCard" class="btn btn-primary">‚ûï Adicionar Card</button>
        <button id="addBall" class="btn btn-secondary">‚ö™ Adicionar Bolinha</button>
        <button id="addRagdoll" class="btn btn-special">ü§∏ Adicionar Ragdoll</button>
        <button id="clearWorld" class="btn btn-danger">üóëÔ∏è Limpar Mundo</button>
        <button id="toggleGravity" class="btn btn-info">üåç Toggle Gravidade</button>
    </div>
    
    <canvas id="world" width="800" height="600"></canvas>
    
    <div class="info">
        <p>üéÆ Clique e arraste os objetos para interagir!</p>
        <p>üéØ Ragdolls mant√™m equil√≠brio automaticamente</p>
        <p id="objectCount">Objetos: 0</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script>
        // Simulador Corrigido
        const { Engine, Render, Runner, Bodies, Composite, Mouse, MouseConstraint, Constraint, Body, Events, Vector } = Matter;

        class FixedSimulator {
            constructor() {
                this.engine = Engine.create();
                this.world = this.engine.world;
                this.objectCount = 0;
                this.ragdolls = [];
                this.gravityEnabled = true;
                
                this.init();
            }

            init() {
                // Configurar renderizador
                this.render = Render.create({
                    element: document.body,
                    canvas: document.getElementById('world'),
                    engine: this.engine,
                    options: {
                        width: 800,
                        height: 600,
                        wireframes: false,
                        background: '#2a2a2a',
                        showAngleIndicator: true,
                        showVelocity: true
                    }
                });

                // Criar paredes
                this.createWalls();
                
                // Configurar mouse
                this.setupMouse();
                
                // Configurar eventos
                this.setupEventListeners();
                
                // Iniciar renderiza√ß√£o
                Render.run(this.render);
                Runner.run(Runner.create(), this.engine);
                
                console.log('‚úÖ Simulador corrigido inicializado!');
            }

            createWalls() {
                const walls = [
                    Bodies.rectangle(400, 610, 810, 60, { isStatic: true, render: { fillStyle: '#333' } }),
                    Bodies.rectangle(400, -10, 810, 60, { isStatic: true, render: { fillStyle: '#333' } }),
                    Bodies.rectangle(-10, 300, 60, 620, { isStatic: true, render: { fillStyle: '#333' } }),
                    Bodies.rectangle(810, 300, 60, 620, { isStatic: true, render: { fillStyle: '#333' } })
                ];
                Composite.add(this.world, walls);
            }

            setupMouse() {
                this.mouse = Mouse.create(this.render.canvas);
                this.mouseConstraint = MouseConstraint.create(this.engine, {
                    mouse: this.mouse,
                    constraint: {
                        stiffness: 0.2,
                        render: {
                            visible: false
                        }
                    }
                });
                
                Composite.add(this.world, this.mouseConstraint);
                this.render.mouse = this.mouse;
            }

            setupEventListeners() {
                document.getElementById('addCard').addEventListener('click', () => this.createCard());
                document.getElementById('addBall').addEventListener('click', () => this.createBall());
                document.getElementById('addRagdoll').addEventListener('click', () => this.createSimpleRagdoll());
                document.getElementById('clearWorld').addEventListener('click', () => this.clearWorld());
                document.getElementById('toggleGravity').addEventListener('click', () => this.toggleGravity());
            }

            createCard() {
                const x = Math.random() * 700 + 50;
                const y = 50;
                const card = Bodies.rectangle(x, y, 60, 90, {
                    render: {
                        fillStyle: '#ff6b6b',
                        strokeStyle: '#333',
                        lineWidth: 2
                    },
                    density: 0.001,
                    friction: 0.8,
                    frictionAir: 0.01
                });
                Composite.add(this.world, card);
                this.updateObjectCount();
                console.log('üÉè Card criado!');
            }

            createBall() {
                const x = Math.random() * 700 + 50;
                const y = 50;
                const ball = Bodies.circle(x, y, 25, {
                    render: {
                        fillStyle: '#4ecdc4',
                        strokeStyle: '#333',
                        lineWidth: 2
                    },
                    density: 0.001,
                    friction: 0.8,
                    frictionAir: 0.01,
                    restitution: 0.8
                });
                Composite.add(this.world, ball);
                this.updateObjectCount();
                console.log('‚ö™ Bolinha criada!');
            }

            createSimpleRagdoll() {
                const x = Math.random() * 600 + 100;
                const y = 100;
                
                // Criar partes do corpo
                const head = Bodies.circle(x, y, 20, {
                    render: { fillStyle: '#ffdbac', strokeStyle: '#333', lineWidth: 2 },
                    density: 0.001,
                    friction: 0.8
                });
                
                const torso = Bodies.rectangle(x, y + 50, 30, 60, {
                    render: { fillStyle: '#4a90e2', strokeStyle: '#333', lineWidth: 2 },
                    density: 0.002,
                    friction: 0.8
                });
                
                const leftArm = Bodies.rectangle(x - 35, y + 30, 12, 40, {
                    render: { fillStyle: '#ffdbac', strokeStyle: '#333', lineWidth: 2 },
                    density: 0.001,
                    friction: 0.8
                });
                
                const rightArm = Bodies.rectangle(x + 35, y + 30, 12, 40, {
                    render: { fillStyle: '#ffdbac', strokeStyle: '#333', lineWidth: 2 },
                    density: 0.001,
                    friction: 0.8
                });
                
                const leftLeg = Bodies.rectangle(x - 15, y + 100, 15, 50, {
                    render: { fillStyle: '#2c3e50', strokeStyle: '#333', lineWidth: 2 },
                    density: 0.001,
                    friction: 0.9
                });
                
                const rightLeg = Bodies.rectangle(x + 15, y + 100, 15, 50, {
                    render: { fillStyle: '#2c3e50', strokeStyle: '#333', lineWidth: 2 },
                    density: 0.001,
                    friction: 0.9
                });
                
                // Criar articula√ß√µes
                const neckConstraint = Constraint.create({
                    bodyA: head,
                    bodyB: torso,
                    length: 10,
                    stiffness: 0.8
                });
                
                const leftShoulderConstraint = Constraint.create({
                    bodyA: torso,
                    bodyB: leftArm,
                    pointA: { x: -15, y: -20 },
                    pointB: { x: 0, y: -20 },
                    length: 5,
                    stiffness: 0.7
                });
                
                const rightShoulderConstraint = Constraint.create({
                    bodyA: torso,
                    bodyB: rightArm,
                    pointA: { x: 15, y: -20 },
                    pointB: { x: 0, y: -20 },
                    length: 5,
                    stiffness: 0.7
                });
                
                const leftHipConstraint = Constraint.create({
                    bodyA: torso,
                    bodyB: leftLeg,
                    pointA: { x: -10, y: 30 },
                    pointB: { x: 0, y: -25 },
                    length: 5,
                    stiffness: 0.8
                });
                
                const rightHipConstraint = Constraint.create({
                    bodyA: torso,
                    bodyB: rightLeg,
                    pointA: { x: 10, y: 30 },
                    pointB: { x: 0, y: -25 },
                    length: 5,
                    stiffness: 0.8
                });
                
                // Adicionar tudo ao mundo
                const ragdollParts = [head, torso, leftArm, rightArm, leftLeg, rightLeg];
                const ragdollConstraints = [neckConstraint, leftShoulderConstraint, rightShoulderConstraint, leftHipConstraint, rightHipConstraint];
                
                Composite.add(this.world, [...ragdollParts, ...ragdollConstraints]);
                
                // Armazenar ragdoll
                const ragdoll = {
                    head, torso, leftArm, rightArm, leftLeg, rightLeg,
                    constraints: ragdollConstraints,
                    id: Math.random().toString(36).substr(2, 9)
                };
                
                this.ragdolls.push(ragdoll);
                this.objectCount += 6;
                this.updateObjectCount();
                
                console.log(`ü§∏ Ragdoll #${this.ragdolls.length} criado!`);
            }

            clearWorld() {
                // Remover todos os corpos exceto as paredes
                const allBodies = Composite.allBodies(this.world);
                const bodiesToRemove = allBodies.filter(body => !body.isStatic);
                Composite.remove(this.world, bodiesToRemove);
                
                // Remover todas as constraints exceto as do mouse
                const allConstraints = Composite.allConstraints(this.world);
                const constraintsToRemove = allConstraints.filter(constraint => constraint !== this.mouseConstraint);
                Composite.remove(this.world, constraintsToRemove);
                
                this.ragdolls = [];
                this.objectCount = 0;
                this.updateObjectCount();
                console.log('üóëÔ∏è Mundo limpo!');
            }

            toggleGravity() {
                this.gravityEnabled = !this.gravityEnabled;
                this.engine.world.gravity.y = this.gravityEnabled ? 1 : 0;
                console.log(`üåç Gravidade: ${this.gravityEnabled ? 'ON' : 'OFF'}`);
            }

            updateObjectCount() {
                document.getElementById('objectCount').textContent = `Objetos: ${this.objectCount}`;
            }
        }

        // Inicializar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', () => {
            const simulator = new FixedSimulator();
            console.log('üöÄ Simulador corrigido carregado!');
        });
    </script>
</body>
</html>